<html>
  <head>
    <title>Wordle Results</title>
    <!-- <link rel="shortcut icon" type="image/png" href="Transact.png"> -->
    <style>
      * {font-family: Arial, sans-serif;
        }
      table, td, th {
        border: 1px solid;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <div id="everything" style="display:none;">
      <table style="font-size: 30px; padding: 6px">
        <thead><tr><th>Date</th></th><th>Word</th><th>Change</th><th>Julia</th><th>Nick</th></tr></thead>
        <tbody id="table-body"></tbody>
    </table>

    <p style="font-size: 30px;"><strong>Add New Wordle Entry</strong></p>

    <form id="entry-form" style="font-size: 30px;">
 
      <label for="thedate">Date:</label>
      <input type="text" id="the-date" style="font-size: 30px; width: 180px" name="thedate" required>

      <label for="theword">Word:</label>
      <input type="text" id="total" style="font-size: 30px; width: 150px;" name="theword" required>

      <label for="chris">Chris:</label>
      <input type="text" id="chris" style="font-size: 30px; width: 150px;" name="chris" required>
      <label for="julia">Julia:</label>
      <input type="text" id="julia" style="font-size: 30px; width: 150px;" name="julia" required>
      <label for="nick">Nick:</label>
      <input type="text" id="nick" style="font-size: 30px; width: 150px;" name="nick" required>

     <button type="submit" style="height: 40px">Submit</button>

    </form>

    <canvas id="line-chart"></canvas>

    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>

      let today = new Date();
 
      let dd = today.getDate();
      let mm = today.getMonth() + 1; // Months are zero-based
      let yyyy = today.getFullYear();

      dd = dd < 10 ? '0' + dd : dd;
      mm = mm < 10 ? '0' + mm : mm;

      let formattedDate = dd + '/' + mm + '/' + yyyy;

      document.getElementById('the-date').value = formattedDate;

      const entryForm = document.getElementById('entry-form');
      const tableBody = document.getElementById('table-body');
      const lineChartCtx = document.getElementById('line-chart').getContext('2d');
  
      let prevTotal = 0;
      let chart; // Holds Chart.js instance

      async function fetchDataAndUpdateUI() {
        const response = await fetch('https://sheetdb.io/api/v1/119pijr0mmgrr');
        const data = await response.json();

        tableBody.innerHTML = '';
        let indx = 0;
        data.forEach(myRow => {
          if (indx >= (data.length - 10)) {
            tableBody.innerHTML += `<tr><td align='right'>${myRow["TheDate"]}</td><td align='right'>${myRow["TheWord"]}</td><td align='right'>${myRow["Chris"]}</td><td align='right'>${myRow["Julia"]}</td><td align='right'>${myRow["Nick"]}</td></tr>`;
          }
          indx = indx + 1;
        }); //data.forEach

  // Prepare chart data
  //      const atEndOf = data.map(row => row["AtEndOf"]);
   //     const total = data.map(row => row["Total"]);

   //     if (chart) {
    //      chart.data.labels = atEndOf;
    //      chart.data.datasets[0].data = total;
    //      chart.update();
     //   } else {
     //     chart = new Chart(lineChartCtx, {
      //      type: 'line',
       //     data: {
    //          labels: atEndOf,
    //          datasets: [{
     //           label: 'Total',
    //            data: total,
     //           borderColor: 'green',
     //           fill: false
    //          }] //datasets
     //       } //data
     //     }); //new Chart
     //   } //if (chart)
     //   document.getElementById("everything").style.display = 'block';

      } //async function fetchDataAndUpdateUI

      entryForm.onsubmit = async (e) => {
        e.preventDefault();
        const theDate = entryForm.thedate.value;
        const theWord = entryForm.theword.value;
        const chris = entryForm.chris.value;
        const julia = entryForm.julia.value;
        const nick = entryForm.nick.value;

        await fetch('https://sheetdb.io/api/v1/119pijr0mmgrr', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify([{ theDate, theWord, chris, julia, nick }])
        }); //await fetch

        entryForm.reset();  // Clear form inputs
    
        fetchDataAndUpdateUI();  // Refresh table and chart
     
      }; //entryForm.onsubmit

// Initial data load
      fetchDataAndUpdateUI();
  
    </script>
    
  </body>
  
</html>
